<!-- تضمين Tailwind CSS لتصميم جميل ومتجاوب -->
<script src="https://cdn.tailwindcss.com"></script>
<style>
  /* تعيين الخط للغة العربية */
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Cairo:wght@200..1000&display=swap');
  body {
    font-family: 'Cairo', 'Inter', sans-serif;
    direction: rtl; /* دعم اللغة العربية */
  }
  /* إخفاء شريط التمرير الأفقي في الكود */
  .code-container {
    overflow-x: auto;
  }
</style>

<div class="min-h-screen bg-gray-900 flex items-center justify-center p-4">
  <div class="w-full max-w-4xl bg-gray-800 rounded-xl shadow-2xl p-6 md:p-10">
    <h1 class="text-3xl font-extrabold text-white mb-6 text-center">
      أداة عرض ونسخ الأكواد (HTML)
    </h1>
    <p class="text-gray-400 mb-6 text-center">
      هذا مثال لكود برمجي يمكنك نسخه بسهولة باستخدام الزر أدناه.
    </p>

    <!-- منطقة الكود المراد نسخه -->
    <div class="relative mb-6">
      <!-- استخدام textarea مخفي لسهولة تحديد ونسخ النص بواسطة JavaScript -->
      <textarea id="codeToCopy" class="hidden">
<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>صفحتي الأولى</title>
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f0f4f8;
            color: #333;
            text-align: right;
            padding: 20px;
        }
        h1 {
            color: #1e40af;
        }
    </style>
</head>
<body>
    <h1>مرحباً بالعالم!</h1>
    <p>هذه هي الصفحة التي أنشأتها للتو باستخدام HTML و CSS.</p>
</body>
</html>
      </textarea>

      <!-- عرض الكود بشكل مرئي مع تمييز الألوان -->
      <pre id="codeDisplay" class="code-container bg-gray-950 p-4 rounded-lg text-sm text-green-400 border border-gray-700 whitespace-pre-wrap leading-relaxed max-h-96"></pre>
    </div>

    <!-- زر النسخ المنفصل والمخصص -->
    <button id="copyButton" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 transform hover:scale-[1.01] shadow-lg focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline ml-2" viewBox="0 0 20 20" fill="currentColor">
        <path d="M7 9a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9z" />
        <path d="M5 3a2 2 0 00-2 2v6a2 2 0 002 2V5h8a2 2 0 00-2-2H5z" />
      </svg>
      انسخ الكود
    </button>

    <!-- منطقة رسائل الحالة (تم النسخ بنجاح/فشل) -->
    <div id="messageBox" class="mt-4 text-center text-sm font-medium h-6">
      <!-- الرسالة تظهر هنا -->
    </div>

  </div>
</div>

<script>
  const codeToCopy = document.getElementById('codeToCopy');
  const copyButton = document.getElementById('copyButton');
  const messageBox = document.getElementById('messageBox');
  const codeDisplay = document.getElementById('codeDisplay');

  // لعرض الكود في الـ <pre>، نقوم بنسخ محتوى الـ textarea وإزالة المسافات البيضاء الزائدة
  codeDisplay.textContent = codeToCopy.value.trim();

  // دالة تحويل نص الكود إلى HTML مع تمييز أساسي للألوان (syntax highlighting)
  function basicSyntaxHighlighting(code) {
    // تمييز علامات HTML (مثل <tag> و </tag>)
    code = code.replace(/(&lt;\/?[\w\s\/]+?&gt;)/g, '<span class="text-yellow-400">$1</span>');
    // تمييز أسماء الخصائص داخل العلامات (مثل id="...")
    code = code.replace(/([\w-]+)="([^"]*)"/g, '<span class="text-blue-400">$1</span>="<span class="text-orange-300">$2</span>"');
    // تمييز التعليقات
    code = code.replace(/(&lt;!--.*?--&gt;)/g, '<span class="text-gray-500 italic">$1</span>');
    // تمييز الكلمات المفتاحية لـ CSS (ككلمة color أو background)
    code = code.replace(/(color|background|font-family|text-align|padding)/g, '<span class="text-pink-400">$1</span>');

    return code;
  }

  // تطبيق تمييز الألوان الأساسي بعد تحويل النص العادي إلى HTML
  const escapedCode = codeToCopy.value.trim()
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;');

  codeDisplay.innerHTML = basicSyntaxHighlighting(escapedCode);

  copyButton.addEventListener('click', async () => {
    // نستخدم النص الأصلي من الـ textarea للنسخ
    const codeText = codeToCopy.value.trim();

    // إعادة تعيين رسالة الحالة
    messageBox.textContent = '';
    messageBox.className = 'mt-4 text-center text-sm font-medium h-6';

    // محاولة استخدام واجهة Clipboard API الحديثة
    if (navigator.clipboard && navigator.clipboard.writeText) {
      try {
        await navigator.clipboard.writeText(codeText);
        messageBox.textContent = '✅ تم نسخ الكود بنجاح!';
        messageBox.classList.add('text-green-400');
        // تغيير نص الزر مؤقتاً
        copyButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline ml-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg> تم النسخ!';
        setTimeout(() => {
            // إعادة الزر إلى حالته الأصلية
            copyButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline ml-2" viewBox="0 0 20 20" fill="currentColor"><path d="M7 9a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9z" /><path d="M5 3a2 2 0 00-2 2v6a2 2 0 002 2V5h8a2 2 0 00-2-2H5z" /></svg> انسخ الكود';
        }, 3000);
      } catch (err) {
        // إذا فشل استخدام API الحديثة، نعود إلى الطريقة القديمة
        fallbackCopy(codeText);
      }
    } else {
      // استخدام الطريقة القديمة في حالة عدم دعم المتصفح
      fallbackCopy(codeText);
    }
  });

  // طريقة النسخ الاحتياطية (موصى بها لإطارات iframes)
  function fallbackCopy(text) {
    try {
        const tempElement = document.createElement('textarea');
        tempElement.value = text;
        tempElement.setAttribute('readonly', '');
        tempElement.style.position = 'absolute';
        tempElement.style.left = '-9999px';
        document.body.appendChild(tempElement);
        tempElement.select();

        // استخدام execCommand القديم
        document.execCommand('copy');
        document.body.removeChild(tempElement);

        messageBox.textContent = '✅ تم نسخ الكود بالطريقة الاحتياطية!';
        messageBox.classList.add('text-yellow-400');
    } catch (err) {
        messageBox.textContent = '❌ فشل النسخ. يرجى النسخ يدوياً.';
        messageBox.classList.add('text-red-400');
        console.error('Copy failed:', err);
    }
  }

</script>
